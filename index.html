<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Image Viewer</title>
  <style>
    :root { --bg:#0d0f12; }
    html, body { height: 100%; }
    body { margin:0; background:var(--bg); overflow:hidden; }
    #viewer { position:fixed; inset:0; background:#0d0f12; }
    #stage  { position:relative; width:100%; height:100%; overflow:hidden; }
    #img    { position:absolute; top:0; left:0; transform-origin:0 0; will-change:transform; max-width:none; max-height:none; pointer-events:none; }
    .space-held { cursor:grab; }
    .panning    { cursor:grabbing; }
  </style>
</head>
<body>
  <div id="viewer" aria-label="Image viewer">
    <div id="stage">
      <img id="img" src="sample.jpg" alt="" />
    </div>
  </div>

  <script>
  (function () {
    const viewer = document.getElementById('viewer');
    const stage  = document.getElementById('stage');
    const img    = document.getElementById('img');

    let naturalW = 1, naturalH = 1;
    let scale = 1, tx = 0, ty = 0;
    const MIN_SCALE = 0.10, MAX_SCALE = 5.00;

    let spaceHeld = false, panning = false;
    let dragStartX = 0, dragStartY = 0, startTX = 0, startTY = 0;

    function applyTransform() {
      img.style.transform = `translate(${tx}px, ${ty}px) scale(${scale})`;
    }

    // Allow panning so image can be fully hidden, but not beyond
    function clampTranslation() {
      const vw = stage.clientWidth, vh = stage.clientHeight;
      const w  = naturalW * scale,  h  = naturalH * scale;
      const minX = -w, maxX = vw;
      const minY = -h, maxY = vh;
      tx = Math.min(Math.max(tx, minX), maxX);
      ty = Math.min(Math.max(ty, minY), maxY);
    }

    function fitToView() {
      const vw = stage.clientWidth, vh = stage.clientHeight;
      const s  = Math.min(vw / naturalW, vh / naturalH);
      scale = Math.min(1, Math.max(MIN_SCALE, Math.min(MAX_SCALE, s)));
      tx = (vw - naturalW * scale) / 2;
      ty = (vh - naturalH * scale) / 2;
      applyTransform();
    }

    function zoomAt(px, py, wheelDy) {
      const prev = scale;
      const next = Math.max(MIN_SCALE, Math.min(MAX_SCALE, prev * Math.pow(1.0015, -wheelDy)));
      if (next === prev) return;

      const x = (px - tx) / prev;
      const y = (py - ty) / prev;

      scale = next;
      tx = px - x * scale;
      ty = py - y * scale;
      clampTranslation();
      applyTransform();
    }

    // Events
    window.addEventListener('resize', () => { clampTranslation(); applyTransform(); });

    viewer.addEventListener('wheel', (e) => {
      if (!e.ctrlKey) return;
      e.preventDefault();
      const r = stage.getBoundingClientRect();
      zoomAt(e.clientX - r.left, e.clientY - r.top, e.deltaY);
    }, { passive: false });

    window.addEventListener('wheel', (e) => {
      if (e.ctrlKey && e.target.closest && e.target.closest('#viewer')) e.preventDefault();
    }, { passive: false });

    window.addEventListener('keydown', (e) => {
      if (e.code === 'Space' && !spaceHeld) { spaceHeld = true; e.preventDefault(); viewer.classList.add('space-held'); }
    });
    window.addEventListener('keyup', (e) => {
      if (e.code === 'Space') { spaceHeld = false; viewer.classList.remove('space-held'); }
    });

    stage.addEventListener('mousedown', (e) => {
      if (!spaceHeld) return;
      e.preventDefault();
      panning = true;
      viewer.classList.add('panning');
      dragStartX = e.clientX; dragStartY = e.clientY;
      startTX = tx; startTY = ty;
    });

    window.addEventListener('mousemove', (e) => {
      if (!panning) return;
      tx = startTX + (e.clientX - dragStartX);
      ty = startTY + (e.clientY - dragStartY);
      clampTranslation();
      applyTransform();
    });

    window.addEventListener('mouseup', () => {
      if (!panning) return;
      panning = false;
      viewer.classList.remove('panning');
    });

    // Init from embedded <img src="sample.jpg">
    function initFromImg() {
      naturalW = img.naturalWidth || 1;
      naturalH = img.naturalHeight || 1;
      fitToView();
    }
    if (img.complete) initFromImg();
    else img.onload = initFromImg;
  })();
  </script>
</body>
</html>